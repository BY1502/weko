# 지식 그래프 기능 활성화 가이드

이 문서는 WeKnora에서 지식 그래프(Neo4j) 기능을 활성화하고 검증하는 방법을 소개합니다. 환경 준비부터 프론트엔드 설정까지의 전체 과정을 안내합니다.

## 사전 조건

- WeKnora 백엔드 및 프론트엔드 기본 배포 완료.
- 사용 가능한 Docker/Docker Compose 실행 환경.
- 로컬 또는 원격에서 접속 가능한 Neo4j 서비스 (프로젝트에 포함된 Docker Compose 사용 권장).

## 1단계: 환경 변수 설정

프로젝트 루트 디렉토리의 `.env` 파일에 다음 변수를 추가하거나 수정하세요:

```bash
NEO4J_ENABLE=true
NEO4J_URI=bolt://neo4j:7687
NEO4J_USERNAME=neo4j
NEO4J_PASSWORD=your_strong_password
# 선택 사항: NEO4J_DATABASE=neo4j
```

설명：

- NEO4J_ENABLE: 반드시 `true`로 설정해야 지식 그래프 관련 로직이 활성화됩니다.
- NEO4J_URI: `neo4j`는 docker-compose 서비스 이름입니다. 외부 인스턴스를 사용하는 경우 실제 주소로 변경하세요.

운영 환경에서 키 관리 시스템을 사용하는 경우, 비밀번호가 안전한 방식으로 주입되도록 하십시오.

## 2단계: Neo4j 서비스 시작

프로젝트에 포함된 Neo4j 컴포넌트를 다음 명령어로 바로 시작할 수 있습니다:

```bash
docker-compose --profile neo4j up -d
```

검증 명령어：

```bash
docker ps | grep neo4j
```

볼륨 마운트나 메모리 설정을 커스텀하려면 `docker-compose.yml` 내의 `neo4j` 서비스 설정을 수정하세요.

## 3단계: WeKnora 서비스 재시작

새로운 환경 변수를 적용하기 위해 백엔드와 프론트엔드를 재시작합니다 (예시):

```bash
make stop && make start
# 또는
docker compose up -d --build
```

백엔드 로그에서 `neo4j` 초기화 성공 메시지가 나오는지 확인하세요.

## 4단계: 프론트엔드에서 엔티티/관계 추출 활성화

1. WeKnora 프론트엔드 관리 페이지에 로그인합니다.
2. '지식 베이스 설정'을 열거나 새 지식 베이스를 생성합니다.
3. '엔티티 추출 활성화(Enable Entity Extraction)' 및 '관계 추출 활성화(Enable Relation Extraction)' 스위치를 켭니다.
4. 화면 안내에 따라 필요한 LLM, 콜백 또는 모델 파라미터를 보충합니다 (필요한 경우).

저장하면, 문서가 입고되는 단계에서 시스템이 자동으로 엔티티 및 관계 추출 작업을 트리거합니다.

## 5단계: 지식 그래프 검증

### 방법 1: Neo4j 콘솔

1. `ttp://localhost:7474` (또는 해당 호스트/포트)에 접속합니다.
2. `.env`에 설정한 계정/비밀번호로 로그인합니다.
3. `MATCH (n) RETURN n LIMIT 50;` 쿼리를 실행하여 새 노드/관계가 생성되었는지 확인합니다.

### 방법 2: WeKnora 인터페이스

지식 베이스나 대화 페이지에서 문서를 업로드한 후, 프론트엔드에 그래프 시각화 입구가 표시되어야 합니다. 대화 시 시스템은 의도(Intent)에 따라 자동으로 그래프를 조회하고 보충 정보를 반환합니다.

## 문제 해결 (Troubleshooting)

- **Neo4j 연결 실패**: 네트워크 연결 상태, `NEO4J_URI`, 사용자 이름/비밀번호가 정확한지 확인하고 Neo4j 컨테이너 로그를 점검하세요.
- **노드가 생성되지 않음**: 지식 베이스 설정에서 엔티티/관계 추출이 켜져 있는지, 업로드한 문서 파싱이 완료되었는지 확인하세요. 백엔드 로그에 추출 작업 예외가 있는지 확인하세요.
- **조회 결과 없음**: Neo4j 콘솔에서 `CALL db.schema.visualization;`을 실행하여 스키마가 존재하는지 확인하고, 필요하다면 문서를 다시 가져오기(Re-import) 하세요.

위 단계를 완료하면 지식 그래프 기능이 성공적으로 활성화되며, RAG 및 에이전트 프로세스와 결합하여 질의응답 품질을 높일 수 있습니다.
