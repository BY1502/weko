## MCP 기능 사용 설명서

### 기능 개요

- **MCP(Model Context Protocol)**는 WeKnora가 외부 도구나 데이터 소스에 안전하게 연결하여, 에이전트(Agent)가 추론 과정에서 사용할 수 있는 능력을 확장해 주는 프로토콜입니다.
- 프론트엔드의 `설정 > MCP 서비스` (`frontend/src/views/settings/McpSettings.vue`) 메뉴에서 모든 서비스를 중앙에서 관리할 수 있으며, 설정 파일을 직접 수정할 필요가 없습니다.
- 각 서비스는 이름, 전송 방식(SSE / HTTP Streamable / Stdio), 연결 주소 또는 명령어, 인증 정보, 그리고 고급 타임아웃 및 재시도 정책을 포함합니다.

### 진입 및 인터페이스

- 콘솔 왼쪽 메뉴의 `설정 -> MCP 서비스`로 이동하면 현재 테넌트의 모든 MCP 서비스 목록을 볼 수 있습니다.
- 목록에서 서비스를 빠르게 켜고 끌 수 있으며, 설명을 확인하거나 우측 메뉴를 통해 "테스트 / 편집 / 삭제"를 수행할 수 있습니다.
- "서비스 추가" 버튼을 누르면 `McpServiceDialog`가 팝업되어 서비스를 생성하거나 수정할 수 있습니다.

### 주요 사용 흐름

1. **서비스 생성**
   - "서비스 추가"를 클릭하고 이름과 설명을 입력한 뒤 전송 방식을 선택합니다.
   - SSE / HTTP Streamable 방식은 접속 가능한 서비스 URL이 필요합니다.
   - Stdio 방식은 실행할 `uvx` 또는 `npx` 명령어와 파라미터가 필요하며, 환경 변수도 추가할 수 있습니다.
   - 필요에 따라 API Key, Bearer Token, 타임아웃 및 재시도 정책을 입력하고 저장하면 목록에 나타납니다.
2. **서비스 시작/중지**
   - 목록의 스위치를 토글하여 활성 상태를 변경합니다. 시스템이 즉시 백엔드 `updateMCPService`를 호출하며, 실패 시 자동으로 상태가 롤백되고 알림이 뜹니다.
3. **연결 테스트**
   - 더보기 메뉴에서 "테스트"를 선택하면, 프론트엔드가 `/api/v1/mcp-services/{id}/test`를 호출하고 `McpTestResult` 팝업을 띄웁니다.
   - 성공 시 해당 서비스에서 사용 가능한 도구 목록(입력 스키마 포함)과 리소스 목록이 표시됩니다.
   - 실패 시 에러 메시지가 표시되므로 네트워크나 인증 문제를 해결하는 데 도움이 됩니다.
4. **편집 / 삭제**
   - "편집"을 누르면 기존 설정을 불러오며, 수정 후 저장하면 됩니다.
   - "삭제"는 확인 팝업을 거쳐 수행되며, 완료 시 목록이 자동 갱신됩니다.

### 사용 팁

- **전송 방식 선택**: 가급적 **SSE**를 우선 사용하여 스트리밍 경험을 확보하세요. 표준 HTTP Streamable 호환이 필요할 때만 전환하세요. 로컬 디버깅이나 오프라인 환경에서는 **Stdio**를 사용하고 동일한 머신에 MCP Server를 띄우는 것이 적합합니다.
- **인증 관리**: API Key나 Token은 "인증 설정"에 저장하세요. 운영 환경에서는 최소 권한을 가진 Key를 별도로 생성하고 정기적으로 교체하는 것이 좋습니다.
- **재시도 정책**: 공용 네트워크나 타사 서비스를 사용할 때는 `retry_count`(재시도 횟수)와 `retry_delay`(재시도 지연)를 적절히 높여, 간헐적인 타임아웃으로 인해 에이전트가 중단되는 것을 방지하세요.
